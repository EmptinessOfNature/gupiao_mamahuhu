
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K线图与附图示例</title>
    <style>
        #chart {
            position: relative;
            width: 100%;
            height: 500px;
        }
        #subchart {
            position: relative;
            width: 100%;
            height: 200px;
        }
    </style>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
    <div id="chart"></div>
    <div id="subchart"></div>
    <script>
        // 主图 K 线图
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            width: window.innerWidth,
            height: 500,
        });

        const candlestickSeries = chart.addCandlestickSeries({
            upColor: 'green',
            downColor: 'red',
            borderUpColor: 'green',
            borderDownColor: 'red',
            wickUpColor: 'green',
            wickDownColor: 'red',
        });

        const data = [{"time":"2023-08-01","open":127,"high":190,"low":126,"close":184,"sma":null},{"time":"2023-08-02","open":158,"high":164,"low":84,"close":133,"sma":null},{"time":"2023-08-03","open":130,"high":200,"low":112,"close":180,"sma":165.6666666667},{"time":"2023-08-04","open":146,"high":213,"low":128,"close":172,"sma":161.6666666667},{"time":"2023-08-05","open":154,"high":182,"low":129,"close":133,"sma":161.6666666667},{"time":"2023-08-06","open":164,"high":211,"low":126,"close":129,"sma":144.6666666667},{"time":"2023-08-07","open":131,"high":205,"low":87,"close":173,"sma":145.0},{"time":"2023-08-08","open":170,"high":202,"low":95,"close":140,"sma":147.3333333333},{"time":"2023-08-09","open":107,"high":185,"low":75,"close":140,"sma":151.0},{"time":"2023-08-10","open":165,"high":213,"low":118,"close":144,"sma":141.3333333333}];
        const formattedData = data.map(item => {
            return {
                time: item.time,
                open: item.open,
                high: item.high,
                low: item.low,
                close: item.close,
            };
        });

        candlestickSeries.setData(formattedData);

        // 附图
        const subchart = LightweightCharts.createChart(document.getElementById('subchart'), {
            width: window.innerWidth,
            height: 200,
        });

        const lineSeries = subchart.addLineSeries({
            color: 'blue',
        });

        const smaData = data.map(item => {
            return {
                time: item.time,
                value: item.sma !== null ? item.sma : undefined, // 处理 NaN
            };
        }).filter(item => item.value !== undefined); // 过滤 NaN

        lineSeries.setData(smaData);
    </script>
</body>
</html>
